
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://github.com/Kirchhoff-Machines/pyrkm/api/rkm/">
      
      
        <link rel="prev" href="../rbm/">
      
      
        <link rel="next" href="../utils/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>RKM class - pyrkm</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="yellow">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pyrkm.rkm.RKM" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="pyrkm" class="md-header__button md-logo" aria-label="pyrkm" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            pyrkm
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              RKM class
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="yellow"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="yellow"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Kirchhoff-Machines/pyrkm" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    pyrkm
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="pyrkm" class="md-nav__button md-logo" aria-label="pyrkm" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    pyrkm
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Kirchhoff-Machines/pyrkm" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    pyrkm
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/first_example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How to train a Restricted Kirchhoff Machine
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../energy_consumption/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Energy consumption
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Python API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Python API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pyrkm
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rbm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RBM class
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    RKM class
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    RKM class
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM" class="md-nav__link">
    <span class="md-ellipsis">
      RKM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RKM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.Adam_update" class="md-nav__link">
    <span class="md-ellipsis">
      Adam_update
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.Bernoulli_h_to_v" class="md-nav__link">
    <span class="md-ellipsis">
      Bernoulli_h_to_v
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.Bernoulli_v_to_h" class="md-nav__link">
    <span class="md-ellipsis">
      Bernoulli_v_to_h
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.Deterministic_h_to_v" class="md-nav__link">
    <span class="md-ellipsis">
      Deterministic_h_to_v
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.Deterministic_v_to_h" class="md-nav__link">
    <span class="md-ellipsis">
      Deterministic_v_to_h
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.SGD_update" class="md-nav__link">
    <span class="md-ellipsis">
      SGD_update
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.after_step_keepup" class="md-nav__link">
    <span class="md-ellipsis">
      after_step_keepup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.av_power_backward" class="md-nav__link">
    <span class="md-ellipsis">
      av_power_backward
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.av_power_forward" class="md-nav__link">
    <span class="md-ellipsis">
      av_power_forward
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.clip_bias" class="md-nav__link">
    <span class="md-ellipsis">
      clip_bias
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.clip_weights" class="md-nav__link">
    <span class="md-ellipsis">
      clip_weights
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.delta_eh" class="md-nav__link">
    <span class="md-ellipsis">
      delta_eh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.delta_ev" class="md-nav__link">
    <span class="md-ellipsis">
      delta_ev
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.derivatives" class="md-nav__link">
    <span class="md-ellipsis">
      derivatives
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.derivatives_hopfield" class="md-nav__link">
    <span class="md-ellipsis">
      derivatives_hopfield
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.generate" class="md-nav__link">
    <span class="md-ellipsis">
      generate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.h_to_v" class="md-nav__link">
    <span class="md-ellipsis">
      h_to_v
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.plot_bias" class="md-nav__link">
    <span class="md-ellipsis">
      plot_bias
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.plot_visible_bias" class="md-nav__link">
    <span class="md-ellipsis">
      plot_visible_bias
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.plot_weights" class="md-nav__link">
    <span class="md-ellipsis">
      plot_weights
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.power_backward" class="md-nav__link">
    <span class="md-ellipsis">
      power_backward
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.power_forward" class="md-nav__link">
    <span class="md-ellipsis">
      power_forward
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.pretrain" class="md-nav__link">
    <span class="md-ellipsis">
      pretrain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.reconstruct" class="md-nav__link">
    <span class="md-ellipsis">
      reconstruct
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.relaxation_times" class="md-nav__link">
    <span class="md-ellipsis">
      relaxation_times
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.train" class="md-nav__link">
    <span class="md-ellipsis">
      train
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.v_to_h" class="md-nav__link">
    <span class="md-ellipsis">
      v_to_h
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../circuit_utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    circuit_utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../classifier/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    classifier
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CONTRIBUTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CODE_OF_CONDUCT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Code of Conduct
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/Kirchhoff-Machines/pyrkm" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ðŸ”— Source code
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/Kirchhoff-Machines/pyrkm/issues" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ðŸ”— Issues
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM" class="md-nav__link">
    <span class="md-ellipsis">
      RKM
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RKM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.Adam_update" class="md-nav__link">
    <span class="md-ellipsis">
      Adam_update
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.Bernoulli_h_to_v" class="md-nav__link">
    <span class="md-ellipsis">
      Bernoulli_h_to_v
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.Bernoulli_v_to_h" class="md-nav__link">
    <span class="md-ellipsis">
      Bernoulli_v_to_h
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.Deterministic_h_to_v" class="md-nav__link">
    <span class="md-ellipsis">
      Deterministic_h_to_v
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.Deterministic_v_to_h" class="md-nav__link">
    <span class="md-ellipsis">
      Deterministic_v_to_h
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.SGD_update" class="md-nav__link">
    <span class="md-ellipsis">
      SGD_update
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.after_step_keepup" class="md-nav__link">
    <span class="md-ellipsis">
      after_step_keepup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.av_power_backward" class="md-nav__link">
    <span class="md-ellipsis">
      av_power_backward
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.av_power_forward" class="md-nav__link">
    <span class="md-ellipsis">
      av_power_forward
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.clip_bias" class="md-nav__link">
    <span class="md-ellipsis">
      clip_bias
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.clip_weights" class="md-nav__link">
    <span class="md-ellipsis">
      clip_weights
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.delta_eh" class="md-nav__link">
    <span class="md-ellipsis">
      delta_eh
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.delta_ev" class="md-nav__link">
    <span class="md-ellipsis">
      delta_ev
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.derivatives" class="md-nav__link">
    <span class="md-ellipsis">
      derivatives
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.derivatives_hopfield" class="md-nav__link">
    <span class="md-ellipsis">
      derivatives_hopfield
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.forward" class="md-nav__link">
    <span class="md-ellipsis">
      forward
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.generate" class="md-nav__link">
    <span class="md-ellipsis">
      generate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.h_to_v" class="md-nav__link">
    <span class="md-ellipsis">
      h_to_v
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.plot_bias" class="md-nav__link">
    <span class="md-ellipsis">
      plot_bias
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.plot_visible_bias" class="md-nav__link">
    <span class="md-ellipsis">
      plot_visible_bias
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.plot_weights" class="md-nav__link">
    <span class="md-ellipsis">
      plot_weights
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.power_backward" class="md-nav__link">
    <span class="md-ellipsis">
      power_backward
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.power_forward" class="md-nav__link">
    <span class="md-ellipsis">
      power_forward
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.pretrain" class="md-nav__link">
    <span class="md-ellipsis">
      pretrain
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.reconstruct" class="md-nav__link">
    <span class="md-ellipsis">
      reconstruct
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.relaxation_times" class="md-nav__link">
    <span class="md-ellipsis">
      relaxation_times
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.train" class="md-nav__link">
    <span class="md-ellipsis">
      train
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pyrkm.rkm.RKM.v_to_h" class="md-nav__link">
    <span class="md-ellipsis">
      v_to_h
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>RKM class</h1>

<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="pyrkm.rkm.RKM" class="doc doc-heading">
              <code class=" language-python"><span class="n">RKM</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">n_visible</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">max_epochs</span><span class="o">=</span><span class="mi">200000</span><span class="p">,</span> <span class="n">energy_type</span><span class="o">=</span><span class="s1">&#39;RKM&#39;</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;SGD&#39;</span><span class="p">,</span> <span class="n">regularization</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">l1_factor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">l2_factor</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">g_v</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">g_h</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">train_algo</span><span class="o">=</span><span class="s1">&#39;vRDM&#39;</span><span class="p">,</span> <span class="n">centering</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">average_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">model_beta</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mytype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">min_W</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_W</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">sampling</span><span class="o">=</span><span class="s1">&#39;bernoulli&#39;</span><span class="p">,</span> <span class="n">distribution</span><span class="o">=</span><span class="s1">&#39;gaussian&#39;</span><span class="p">,</span> <span class="n">layer_scaled</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="RBM(model_name, n_visible, n_hidden, k=1, lr=0.001, max_epochs=200000, energy_type='hopfield', optimizer='SGD', regularization=False, l1_factor=0, l2_factor=0.001, g_v=0.5, g_h=0.5, batch_size=1, train_algo='vRDM', centering=False, average_data=None, model_beta=1, mytype=torch.float32, min_W=-10, max_W=10)

  
      dataclass
   (pyrkm.rbm.RBM)" href="../rbm/#pyrkm.rbm.RBM">RBM</a></code></p>


        <p>A class to represent a Restricted Kirchhoff Machine (RKM).
It is inherited from the RBM class, so look at the RBM class for info about the attributes and methods.
Also, refer to the paper XXX for more details on the RKM.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>energy_type</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>, default:
                  <code>&#39;RKM&#39;</code>
)
          â€“
          <div class="doc-md-description">
            <p>The type of energy function to use (default is 'RKM').</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>offset</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>, default:
                  <code>0.0</code>
)
          â€“
          <div class="doc-md-description">
            <p>Offset parameter for the energy function (default is 0.0).</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>sampling</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>, default:
                  <code>&#39;bernoulli&#39;</code>
)
          â€“
          <div class="doc-md-description">
            <p>Sampling method to use (default is 'bernoulli').</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>distribution</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>, default:
                  <code>&#39;gaussian&#39;</code>
)
          â€“
          <div class="doc-md-description">
            <p>Distribution to use for sampling (default is 'gaussian').</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>layer_scaled</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>True</code>
)
          â€“
          <div class="doc-md-description">
            <p>Whether to scale the layer by the number of units (default is True).</p>
          </div>
        </li>
    </ul>










  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.Adam_update" class="doc doc-heading">
            <code class=" language-python"><span class="n">Adam_update</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">dEdW_data</span><span class="p">,</span> <span class="n">dEdW_model</span><span class="p">,</span> <span class="n">dEdv_bias_data</span><span class="p">,</span> <span class="n">dEdv_bias_model</span><span class="p">,</span> <span class="n">dEdh_bias_data</span><span class="p">,</span> <span class="n">dEdh_bias_model</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update the model parameters using Adam optimizer.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>t</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
          â€“
          <div class="doc-md-description">
            <p>Current time step.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>dEdW_data</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Gradient of the weights from data.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>dEdW_model</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Gradient of the weights from the model.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>dEdv_bias_data</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Gradient of the visible biases from data.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>dEdv_bias_model</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Gradient of the visible biases from the model.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>dEdh_bias_data</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Gradient of the hidden biases from data.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>dEdh_bias_model</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Gradient of the hidden biases from the model.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">Adam_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">dEdW_data</span><span class="p">,</span> <span class="n">dEdW_model</span><span class="p">,</span> <span class="n">dEdv_bias_data</span><span class="p">,</span>
                <span class="n">dEdv_bias_model</span><span class="p">,</span> <span class="n">dEdh_bias_data</span><span class="p">,</span> <span class="n">dEdh_bias_model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the model parameters using Adam optimizer.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t : int</span>
<span class="sd">        Current time step.</span>
<span class="sd">    dEdW_data : torch.Tensor</span>
<span class="sd">        Gradient of the weights from data.</span>
<span class="sd">    dEdW_model : torch.Tensor</span>
<span class="sd">        Gradient of the weights from the model.</span>
<span class="sd">    dEdv_bias_data : torch.Tensor</span>
<span class="sd">        Gradient of the visible biases from data.</span>
<span class="sd">    dEdv_bias_model : torch.Tensor</span>
<span class="sd">        Gradient of the visible biases from the model.</span>
<span class="sd">    dEdh_bias_data : torch.Tensor</span>
<span class="sd">        Gradient of the hidden biases from data.</span>
<span class="sd">    dEdh_bias_model : torch.Tensor</span>
<span class="sd">        Gradient of the hidden biases from the model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Gradients</span>
    <span class="n">dW</span> <span class="o">=</span> <span class="o">-</span><span class="n">dEdW_data</span> <span class="o">+</span> <span class="n">dEdW_model</span>
    <span class="n">dv</span> <span class="o">=</span> <span class="o">-</span><span class="n">dEdv_bias_data</span> <span class="o">+</span> <span class="n">dEdv_bias_model</span>
    <span class="n">dh</span> <span class="o">=</span> <span class="o">-</span><span class="n">dEdh_bias_data</span> <span class="o">+</span> <span class="n">dEdh_bias_model</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">centering</span><span class="p">:</span>
        <span class="n">dv</span> <span class="o">=</span> <span class="n">dv</span> <span class="o">-</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oh</span><span class="p">,</span> <span class="n">dW</span><span class="p">)</span>
        <span class="n">dh</span> <span class="o">=</span> <span class="n">dh</span> <span class="o">-</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ov</span><span class="p">,</span> <span class="n">dW</span><span class="o">.</span><span class="n">t</span><span class="p">())</span>
    <span class="c1"># Add regularization term</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">regularization</span> <span class="o">==</span> <span class="s1">&#39;l2&#39;</span><span class="p">:</span>
        <span class="n">dW</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l2</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span>
        <span class="n">dv</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l2</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_bias</span>
        <span class="n">dh</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l2</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_bias</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">regularization</span> <span class="o">==</span> <span class="s1">&#39;l1&#39;</span><span class="p">:</span>
        <span class="n">dW</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l1</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span>
        <span class="n">dv</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l1</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_bias</span><span class="p">)</span>
        <span class="n">dh</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l1</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_bias</span><span class="p">)</span>
    <span class="c1"># momentum beta1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">m_dW</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_dW</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dW</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">m_dv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_dv</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dv</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">m_dh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_dh</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dh</span>
    <span class="c1"># momentum beta2</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">v_dW</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_dW</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">dW</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">v_dv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_dv</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">dv</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">v_dh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_dh</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">dh</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1"># bias correction</span>
    <span class="n">m_dW_corr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_dW</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="o">**</span><span class="n">t</span><span class="p">)</span>
    <span class="n">m_dv_corr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_dv</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="o">**</span><span class="n">t</span><span class="p">)</span>
    <span class="n">m_dh_corr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_dh</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta1</span><span class="o">**</span><span class="n">t</span><span class="p">)</span>
    <span class="n">v_dW_corr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_dW</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span><span class="o">**</span><span class="n">t</span><span class="p">)</span>
    <span class="n">v_dv_corr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_dv</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span><span class="o">**</span><span class="n">t</span><span class="p">)</span>
    <span class="n">v_dh_corr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_dh</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta2</span><span class="o">**</span><span class="n">t</span><span class="p">)</span>
    <span class="c1"># Update</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr</span> <span class="o">*</span> <span class="p">(</span><span class="n">m_dW_corr</span> <span class="o">/</span>
                                 <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v_dW_corr</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">v_bias</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_bias</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">m_dv_corr</span> <span class="o">/</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v_dv_corr</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">h_bias</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_bias</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">m_dh_corr</span> <span class="o">/</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v_dh_corr</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.Bernoulli_h_to_v" class="doc doc-heading">
            <code class=" language-python"><span class="n">Bernoulli_h_to_v</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Convert hidden units to visible units using Bernoulli sampling.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>h</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Hidden units.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>beta</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
          â€“
          <div class="doc-md-description">
            <p>Inverse temperature parameter.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>tuple of torch.Tensor</code>
          â€“
          <div class="doc-md-description">
            <p>Probabilities and sampled visible units.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">Bernoulli_h_to_v</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert hidden units to visible units using Bernoulli sampling.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    h : torch.Tensor</span>
<span class="sd">        Hidden units.</span>
<span class="sd">    beta : float</span>
<span class="sd">        Inverse temperature parameter.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple of torch.Tensor</span>
<span class="sd">        Probabilities and sampled visible units.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p_v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prob_v_given_h</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
    <span class="n">sample_v</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">bernoulli</span><span class="p">(</span><span class="n">p_v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p_v</span><span class="p">,</span> <span class="n">sample_v</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.Bernoulli_v_to_h" class="doc doc-heading">
            <code class=" language-python"><span class="n">Bernoulli_v_to_h</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Convert visible units to hidden units using Bernoulli sampling.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>v</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Visible units.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>beta</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
          â€“
          <div class="doc-md-description">
            <p>Inverse temperature parameter.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>tuple of torch.Tensor</code>
          â€“
          <div class="doc-md-description">
            <p>Probabilities and sampled hidden units.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">Bernoulli_v_to_h</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert visible units to hidden units using Bernoulli sampling.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    v : torch.Tensor</span>
<span class="sd">        Visible units.</span>
<span class="sd">    beta : float</span>
<span class="sd">        Inverse temperature parameter.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple of torch.Tensor</span>
<span class="sd">        Probabilities and sampled hidden units.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p_h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prob_h_given_v</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
    <span class="n">sample_h</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">bernoulli</span><span class="p">(</span><span class="n">p_h</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p_h</span><span class="p">,</span> <span class="n">sample_h</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.Deterministic_h_to_v" class="doc doc-heading">
            <code class=" language-python"><span class="n">Deterministic_h_to_v</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Deterministically convert hidden units to visible units.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>h</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Hidden units.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>beta</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
          â€“
          <div class="doc-md-description">
            <p>Inverse temperature parameter.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>tuple of torch.Tensor</code>
          â€“
          <div class="doc-md-description">
            <p>Deterministic visible units.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">Deterministic_h_to_v</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Deterministically convert hidden units to visible units.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    h : torch.Tensor</span>
<span class="sd">        Hidden units.</span>
<span class="sd">    beta : float</span>
<span class="sd">        Inverse temperature parameter.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple of torch.Tensor</span>
<span class="sd">        Deterministic visible units.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delta_ev</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span><span class="p">,</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.Deterministic_v_to_h" class="doc doc-heading">
            <code class=" language-python"><span class="n">Deterministic_v_to_h</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Deterministically convert visible units to hidden units.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>v</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Visible units.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>beta</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>)
          â€“
          <div class="doc-md-description">
            <p>Inverse temperature parameter.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>tuple of torch.Tensor</code>
          â€“
          <div class="doc-md-description">
            <p>Deterministic hidden units.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">Deterministic_v_to_h</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Deterministically convert visible units to hidden units.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    v : torch.Tensor</span>
<span class="sd">        Visible units.</span>
<span class="sd">    beta : float</span>
<span class="sd">        Inverse temperature parameter.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple of torch.Tensor</span>
<span class="sd">        Deterministic hidden units.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delta_eh</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">h</span><span class="p">,</span> <span class="n">h</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.SGD_update" class="doc doc-heading">
            <code class=" language-python"><span class="n">SGD_update</span><span class="p">(</span><span class="n">dEdW_data</span><span class="p">,</span> <span class="n">dEdW_model</span><span class="p">,</span> <span class="n">dEdv_bias_data</span><span class="p">,</span> <span class="n">dEdv_bias_model</span><span class="p">,</span> <span class="n">dEdh_bias_data</span><span class="p">,</span> <span class="n">dEdh_bias_model</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update the model parameters using SGD.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>dEdW_data</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Gradient of the weights from data.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>dEdW_model</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Gradient of the weights from the model.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>dEdv_bias_data</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Gradient of the visible biases from data.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>dEdv_bias_model</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Gradient of the visible biases from the model.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>dEdh_bias_data</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Gradient of the hidden biases from data.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>dEdh_bias_model</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Gradient of the hidden biases from the model.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">SGD_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dEdW_data</span><span class="p">,</span> <span class="n">dEdW_model</span><span class="p">,</span> <span class="n">dEdv_bias_data</span><span class="p">,</span>
               <span class="n">dEdv_bias_model</span><span class="p">,</span> <span class="n">dEdh_bias_data</span><span class="p">,</span> <span class="n">dEdh_bias_model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the model parameters using SGD.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dEdW_data : torch.Tensor</span>
<span class="sd">        Gradient of the weights from data.</span>
<span class="sd">    dEdW_model : torch.Tensor</span>
<span class="sd">        Gradient of the weights from the model.</span>
<span class="sd">    dEdv_bias_data : torch.Tensor</span>
<span class="sd">        Gradient of the visible biases from data.</span>
<span class="sd">    dEdv_bias_model : torch.Tensor</span>
<span class="sd">        Gradient of the visible biases from the model.</span>
<span class="sd">    dEdh_bias_data : torch.Tensor</span>
<span class="sd">        Gradient of the hidden biases from data.</span>
<span class="sd">    dEdh_bias_model : torch.Tensor</span>
<span class="sd">        Gradient of the hidden biases from the model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Gradients</span>
    <span class="n">dW</span> <span class="o">=</span> <span class="o">-</span><span class="n">dEdW_data</span> <span class="o">+</span> <span class="n">dEdW_model</span>
    <span class="n">dv</span> <span class="o">=</span> <span class="o">-</span><span class="n">dEdv_bias_data</span> <span class="o">+</span> <span class="n">dEdv_bias_model</span>
    <span class="n">dh</span> <span class="o">=</span> <span class="o">-</span><span class="n">dEdh_bias_data</span> <span class="o">+</span> <span class="n">dEdh_bias_model</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">centering</span><span class="p">:</span>
        <span class="n">dv</span> <span class="o">=</span> <span class="n">dv</span> <span class="o">-</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oh</span><span class="p">,</span> <span class="n">dW</span><span class="p">)</span>
        <span class="n">dh</span> <span class="o">=</span> <span class="n">dh</span> <span class="o">-</span> <span class="n">torch</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ov</span><span class="p">,</span> <span class="n">dW</span><span class="o">.</span><span class="n">t</span><span class="p">())</span>
    <span class="c1"># Add regularization term</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">regularization</span> <span class="o">==</span> <span class="s1">&#39;l2&#39;</span><span class="p">:</span>
        <span class="n">dW</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l2</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span>
        <span class="n">dv</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l2</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_bias</span>
        <span class="n">dh</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l2</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_bias</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">regularization</span> <span class="o">==</span> <span class="s1">&#39;l1&#39;</span><span class="p">:</span>
        <span class="n">dW</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l1</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span>
        <span class="n">dv</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l1</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_bias</span><span class="p">)</span>
        <span class="n">dh</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l1</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_bias</span><span class="p">)</span>
    <span class="c1"># Update parameters in-place</span>
    <span class="c1"># # and clip</span>
    <span class="c1"># gnorm = torch.norm(dW) + torch.norm(dv) + torch.norm(dh)</span>
    <span class="c1"># myclip = (self.lr*10.) / gnorm if gnorm &gt; 10 else self.lr</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">add_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lr</span> <span class="o">*</span> <span class="n">dW</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">v_bias</span><span class="o">.</span><span class="n">add_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lr</span> <span class="o">*</span> <span class="n">dv</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">h_bias</span><span class="o">.</span><span class="n">add_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lr</span> <span class="o">*</span> <span class="n">dh</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.after_step_keepup" class="doc doc-heading">
            <code class=" language-python"><span class="n">after_step_keepup</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Perform operations after each training step.</p>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">after_step_keepup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform operations after each training step.&quot;&quot;&quot;</span>
    <span class="c1"># self.W_t = self.W.t() # already done in clip_weights</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">clip_weights</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">clip_bias</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.av_power_backward" class="doc doc-heading">
            <code class=" language-python"><span class="n">av_power_backward</span><span class="p">(</span><span class="n">h</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Computes the average power dissipated by the RKM in the backward pass.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>h</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Hidden units, shape (N, n_h).</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="torch.Tensor">Tensor</span></code>
          â€“
          <div class="doc-md-description">
            <p>Average power dissipated by the RKM.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">av_power_backward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes the average power dissipated by the RKM in the backward pass.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    h : torch.Tensor</span>
<span class="sd">        Hidden units, shape (N, n_h).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    torch.Tensor</span>
<span class="sd">        Average power dissipated by the RKM.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">power_backward</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.av_power_forward" class="doc doc-heading">
            <code class=" language-python"><span class="n">av_power_forward</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Computes the average power dissipated by the RKM in the forward pass.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>v</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Visible units, shape (N, n_v).</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="torch.Tensor">Tensor</span></code>
          â€“
          <div class="doc-md-description">
            <p>Average power dissipated by the RKM.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">av_power_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes the average power dissipated by the RKM in the forward pass.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    v : torch.Tensor</span>
<span class="sd">        Visible units, shape (N, n_v).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    torch.Tensor</span>
<span class="sd">        Average power dissipated by the RKM.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">power_forward</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.clip_bias" class="doc doc-heading">
            <code class=" language-python"><span class="n">clip_bias</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Clip the biases to be within the specified range.</p>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">clip_bias</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clip the biases to be within the specified range.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">v_bias</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_bias</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_W</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">h_bias</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_bias</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_W</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.clip_weights" class="doc doc-heading">
            <code class=" language-python"><span class="n">clip_weights</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Clip the weights to be within the specified range.</p>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">clip_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clip the weights to be within the specified range.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_W</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_W</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">W_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">t</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.delta_eh" class="doc doc-heading">
            <code class=" language-python"><span class="n">delta_eh</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Compute the change in energy for hidden units given visible units.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>v</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Visible units.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="torch.Tensor">Tensor</span></code>
          â€“
          <div class="doc-md-description">
            <p>Change in energy for hidden units.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delta_eh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the change in energy for hidden units given visible units.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    v : torch.Tensor</span>
<span class="sd">        Visible units.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    torch.Tensor</span>
<span class="sd">        Change in energy for hidden units.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy_type</span> <span class="o">==</span> <span class="s1">&#39;hopfield&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta_eh_hopfield</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># exit error</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: delta_eh not implemented for this energy type&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.delta_ev" class="doc doc-heading">
            <code class=" language-python"><span class="n">delta_ev</span><span class="p">(</span><span class="n">h</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Compute the change in energy for visible units given hidden units.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>h</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Hidden units.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="torch.Tensor">Tensor</span></code>
          â€“
          <div class="doc-md-description">
            <p>Change in energy for visible units.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">delta_ev</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the change in energy for visible units given hidden units.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    h : torch.Tensor</span>
<span class="sd">        Hidden units.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    torch.Tensor</span>
<span class="sd">        Change in energy for visible units.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy_type</span> <span class="o">==</span> <span class="s1">&#39;hopfield&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delta_ev_hopfield</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># exit error</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: delta_ev not implemented for this energy type&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.derivatives" class="doc doc-heading">
            <code class=" language-python"><span class="n">derivatives</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Compute the derivatives for the specified energy type.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>v</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Visible units.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>h</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Hidden units.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>tuple of torch.Tensor</code>
          â€“
          <div class="doc-md-description">
            <p>Gradients of the weights, visible biases, and hidden biases.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">derivatives</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the derivatives for the specified energy type.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    v : torch.Tensor</span>
<span class="sd">        Visible units.</span>
<span class="sd">    h : torch.Tensor</span>
<span class="sd">        Hidden units.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple of torch.Tensor</span>
<span class="sd">        Gradients of the weights, visible biases, and hidden biases.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy_type</span> <span class="o">==</span> <span class="s1">&#39;hopfield&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy_type</span> <span class="o">==</span> <span class="s1">&#39;RKM&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">derivatives_hopfield</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># exit error</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: derivatives not implemented for this energy type&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.derivatives_hopfield" class="doc doc-heading">
            <code class=" language-python"><span class="n">derivatives_hopfield</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Compute the derivatives for the Hopfield energy.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>v</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Visible units.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>h</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Hidden units.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>tuple of torch.Tensor</code>
          â€“
          <div class="doc-md-description">
            <p>Gradients of the weights, visible biases, and hidden biases.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">derivatives_hopfield</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the derivatives for the Hopfield energy.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    v : torch.Tensor</span>
<span class="sd">        Visible units.</span>
<span class="sd">    h : torch.Tensor</span>
<span class="sd">        Hidden units.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple of torch.Tensor</span>
<span class="sd">        Gradients of the weights, visible biases, and hidden biases.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># h has shape (N, n_h) and v has shape (N, n_v), we want result to have shape (N, n_h, n_v)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">centering</span><span class="p">:</span>
        <span class="n">dEdW</span> <span class="o">=</span> <span class="o">-</span><span class="n">torch</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,ik-&gt;ijk&#39;</span><span class="p">,</span> <span class="n">h</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">oh</span><span class="p">,</span> <span class="n">v</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ov</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dEdW</span> <span class="o">=</span> <span class="o">-</span><span class="n">torch</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,ik-&gt;ijk&#39;</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="n">dEdv_bias</span> <span class="o">=</span> <span class="o">-</span><span class="n">v</span>
    <span class="n">dEdh_bias</span> <span class="o">=</span> <span class="o">-</span><span class="n">h</span>
    <span class="k">return</span> <span class="n">dEdW</span><span class="p">,</span> <span class="n">dEdv_bias</span><span class="p">,</span> <span class="n">dEdh_bias</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.forward" class="doc doc-heading">
            <code class=" language-python"><span class="n">forward</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Perform a forward pass through the network.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>v</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Visible units.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>k</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
          â€“
          <div class="doc-md-description">
            <p>Number of Gibbs sampling steps.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>beta</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>, default:
                  <code>None</code>
)
          â€“
          <div class="doc-md-description">
            <p>Inverse temperature parameter, by default None.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="torch.Tensor">Tensor</span></code>
          â€“
          <div class="doc-md-description">
            <p>Reconstructed visible units.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform a forward pass through the network.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    v : torch.Tensor</span>
<span class="sd">        Visible units.</span>
<span class="sd">    k : int</span>
<span class="sd">        Number of Gibbs sampling steps.</span>
<span class="sd">    beta : float, optional</span>
<span class="sd">        Inverse temperature parameter, by default None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    torch.Tensor</span>
<span class="sd">        Reconstructed visible units.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_beta</span>
    <span class="n">pre_h1</span><span class="p">,</span> <span class="n">h1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_to_h</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
    <span class="n">h_</span> <span class="o">=</span> <span class="n">h1</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
        <span class="n">pre_v_</span><span class="p">,</span> <span class="n">v_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_to_v</span><span class="p">(</span><span class="n">h_</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
        <span class="n">pre_h_</span><span class="p">,</span> <span class="n">h_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_to_h</span><span class="p">(</span><span class="n">v_</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v_</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.generate" class="doc doc-heading">
            <code class=" language-python"><span class="n">generate</span><span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">h_binarized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">from_visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate samples from the model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>n_samples</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
          â€“
          <div class="doc-md-description">
            <p>Number of samples to generate.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>k</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
          â€“
          <div class="doc-md-description">
            <p>Number of Gibbs sampling steps.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>h_binarized</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>True</code>
)
          â€“
          <div class="doc-md-description">
            <p>Whether to binarize hidden units, by default True.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>from_visible</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>True</code>
)
          â€“
          <div class="doc-md-description">
            <p>Whether to generate from visible units, by default True.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>beta</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>, default:
                  <code>None</code>
)
          â€“
          <div class="doc-md-description">
            <p>Inverse temperature parameter, by default None.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><a class="autorefs autorefs-external" title="numpy.ndarray" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray">ndarray</a></code>
          â€“
          <div class="doc-md-description">
            <p>Generated samples.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">n_samples</span><span class="p">,</span>
             <span class="n">k</span><span class="p">,</span>
             <span class="n">h_binarized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">from_visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">beta</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate samples from the model.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n_samples : int</span>
<span class="sd">        Number of samples to generate.</span>
<span class="sd">    k : int</span>
<span class="sd">        Number of Gibbs sampling steps.</span>
<span class="sd">    h_binarized : bool, optional</span>
<span class="sd">        Whether to binarize hidden units, by default True.</span>
<span class="sd">    from_visible : bool, optional</span>
<span class="sd">        Whether to generate from visible units, by default True.</span>
<span class="sd">    beta : float, optional</span>
<span class="sd">        Inverse temperature parameter, by default None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    numpy.ndarray</span>
<span class="sd">        Generated samples.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_beta</span>
    <span class="k">if</span> <span class="n">from_visible</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">high</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                          <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_visible</span><span class="p">),</span>
                          <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
                          <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mytype</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">h_binarized</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">high</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                              <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_hidden</span><span class="p">),</span>
                              <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
                              <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mytype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n_samples</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">n_hidden</span><span class="p">,</span>
                           <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
                           <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mytype</span><span class="p">)</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_to_v</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="n">v_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v_model</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.h_to_v" class="doc doc-heading">
            <code class=" language-python"><span class="n">h_to_v</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Convert hidden units to visible units.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>h</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Hidden units.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>beta</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>, default:
                  <code>None</code>
)
          â€“
          <div class="doc-md-description">
            <p>Inverse temperature parameter, by default None.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>tuple of torch.Tensor</code>
          â€“
          <div class="doc-md-description">
            <p>Probabilities and sampled visible units.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">h_to_v</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert hidden units to visible units.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    h : torch.Tensor</span>
<span class="sd">        Hidden units.</span>
<span class="sd">    beta : float, optional</span>
<span class="sd">        Inverse temperature parameter, by default None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple of torch.Tensor</span>
<span class="sd">        Probabilities and sampled visible units.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_beta</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy_type</span> <span class="o">==</span> <span class="s1">&#39;RKM&#39;</span><span class="p">:</span>
        <span class="n">effective_v_bias</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_bias</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">*</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_bias</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_bias</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_v</span> <span class="o">+</span>
            <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span> <span class="o">+</span> <span class="n">effective_v_bias</span>
        <span class="n">den</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_bias</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_v</span>
        <span class="n">v_analog</span> <span class="o">=</span> <span class="n">num</span> <span class="o">/</span> <span class="n">den</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling</span> <span class="o">==</span> <span class="s1">&#39;bernoulli&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_scaled</span><span class="p">:</span>
                <span class="n">p_v</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">beta</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_hidden</span> <span class="o">*</span> <span class="n">v_analog</span><span class="p">)</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">bernoulli</span><span class="p">(</span><span class="n">p_v</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p_v</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">beta</span> <span class="o">*</span> <span class="n">v_analog</span><span class="p">)</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">bernoulli</span><span class="p">(</span><span class="n">p_v</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling</span> <span class="o">==</span> <span class="s1">&#39;multi-threshold&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span> <span class="o">==</span> <span class="s1">&#39;gaussian&#39;</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn_like</span><span class="p">(</span><span class="n">v_analog</span><span class="p">,</span>
                                     <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mytype</span><span class="p">,</span>
                                     <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">beta</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand_like</span><span class="p">(</span>
                    <span class="n">v_analog</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mytype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span>
                     <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">beta</span>
            <span class="n">p_v</span> <span class="o">=</span> <span class="n">v_analog</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_scaled</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_v</span> <span class="o">&gt;</span> <span class="n">t</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_hidden</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_v</span> <span class="o">&gt;</span> <span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling</span> <span class="o">==</span> <span class="s1">&#39;single-threshold&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span> <span class="o">==</span> <span class="s1">&#39;gaussian&#39;</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span>
                    <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mytype</span><span class="p">,</span>
                    <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span>
                        <span class="n">v_analog</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mytype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mytype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> <span class="o">*</span>
                     <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span>
                         <span class="n">v_analog</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mytype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
            <span class="n">p_v</span> <span class="o">=</span> <span class="n">v_analog</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_scaled</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_v</span> <span class="o">&gt;</span> <span class="n">t</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_hidden</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_v</span> <span class="o">&gt;</span> <span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p_v</span><span class="p">,</span> <span class="n">v</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">h_to_v</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.plot_bias" class="doc doc-heading">
            <code class=" language-python"><span class="n">plot_bias</span><span class="p">(</span><span class="n">t</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot the biases of the model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>t</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
          â€“
          <div class="doc-md-description">
            <p>Current epoch.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_bias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot the biases of the model.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t : int</span>
<span class="sd">        Current epoch.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">h_bias</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_bias</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="n">v_bias</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_bias</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
    <span class="c1"># Set up the figure with two subplots</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="c1"># Plot histogram for hidden biases</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">h_bias</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Values&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Hidden Biases epoch </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="c1"># Plot histogram for visible biases</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">v_bias</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Values&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Visible Biases epoch </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="c1"># Adjust layout for better readability</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.plot_visible_bias" class="doc doc-heading">
            <code class=" language-python"><span class="n">plot_visible_bias</span><span class="p">(</span><span class="n">t</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot the visible biases of the model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>t</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
          â€“
          <div class="doc-md-description">
            <p>Current epoch.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_visible_bias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot the visible biases of the model.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t : int</span>
<span class="sd">        Current epoch.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Reshape the vector into a 2D array</span>
    <span class="n">data_2d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_bias</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>
    <span class="c1"># Create a figure and axis for the plot</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="c1"># Plot the 2D array</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_2d</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;magma&#39;</span><span class="p">)</span>
    <span class="c1"># Add a colorbar</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Values&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>
    <span class="c1"># Add title and labels</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Visible Biases epoch </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Columns&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Rows&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.plot_weights" class="doc doc-heading">
            <code class=" language-python"><span class="n">plot_weights</span><span class="p">(</span><span class="n">t</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Plot the weights of the model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>t</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
          â€“
          <div class="doc-md-description">
            <p>Current epoch.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot the weights of the model.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    t : int</span>
<span class="sd">        Current epoch.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Ndata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># Reshape the matrix into a 3D array</span>
    <span class="n">data_3d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Ndata</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>
    <span class="c1"># Determine the number of rows and columns for the subplot grid</span>
    <span class="n">num_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Ndata</span><span class="p">)))</span>
    <span class="n">num_cols</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">Ndata</span> <span class="o">/</span> <span class="n">num_rows</span><span class="p">))</span>
    <span class="c1"># Create a figure and axis for the plot</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">num_rows</span><span class="p">,</span>
                           <span class="n">ncols</span><span class="o">=</span><span class="n">num_cols</span><span class="p">,</span>
                           <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="c1"># Iterate over the submatrices and plot them</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ndata</span><span class="p">):</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">i</span> <span class="o">//</span> <span class="n">num_cols</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="n">num_cols</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_3d</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;magma&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
    <span class="c1"># Remove empty subplots if the number of submatrices doesn&#39;t fill the entire grid</span>
    <span class="k">if</span> <span class="n">num_rows</span> <span class="o">*</span> <span class="n">num_cols</span> <span class="o">&gt;</span> <span class="n">Ndata</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ndata</span><span class="p">,</span> <span class="n">num_rows</span> <span class="o">*</span> <span class="n">num_cols</span><span class="p">):</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">i</span> <span class="o">//</span> <span class="n">num_cols</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="n">num_cols</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">])</span>
    <span class="c1"># Adjust the spacing between subplots</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Weights epoch </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
    <span class="c1"># Get the minimum and maximum values from the data</span>
    <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
    <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
    <span class="c1"># Create a dummy image for the colorbar</span>
    <span class="n">dummy_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># Dummy image with all zeros</span>
    <span class="c1"># Add a colorbar using the dummy image as the mappable</span>
    <span class="n">cax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.93</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">])</span>  <span class="c1"># Position of the colorbar</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dummy_img</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;magma&#39;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">),</span>
                 <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
    <span class="c1"># Adjust the height of the colorbar axes to match the height of the figure</span>
    <span class="n">cax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.power_backward" class="doc doc-heading">
            <code class=" language-python"><span class="n">power_backward</span><span class="p">(</span><span class="n">h</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Computes the power dissipated by the RKM in the backward pass.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>h</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Hidden units, shape (N, n_h).</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="torch.Tensor">Tensor</span></code>
          â€“
          <div class="doc-md-description">
            <p>Power dissipated by the RKM, shape (N,).</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">power_backward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes the power dissipated by the RKM in the backward pass.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    h : torch.Tensor</span>
<span class="sd">        Hidden units, shape (N, n_h).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    torch.Tensor</span>
<span class="sd">        Power dissipated by the RKM, shape (N,).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">effective_v_bias</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_bias</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">*</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_bias</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_bias</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_v</span> <span class="o">+</span>
        <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span> <span class="o">+</span> <span class="n">effective_v_bias</span>
    <span class="n">den</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_bias</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_v</span>
    <span class="n">v_analog</span> <span class="o">=</span> <span class="n">num</span> <span class="o">/</span> <span class="n">den</span>

    <span class="n">W_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W_t</span>
    <span class="n">abs_W_t</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_t</span><span class="p">)</span>
    <span class="n">v_bias</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_bias</span>
    <span class="n">abs_v_bias</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_bias</span><span class="p">)</span>

    <span class="n">power_backward</span> <span class="o">=</span> <span class="p">(</span>
        <span class="o">-</span><span class="n">torch</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ni,ij,nj-&gt;n&#39;</span><span class="p">,</span> <span class="n">v_analog</span><span class="p">,</span> <span class="n">W_t</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span>
        <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ni,ij-&gt;n&#39;</span><span class="p">,</span> <span class="n">v_analog</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">abs_W_t</span><span class="p">)</span> <span class="o">+</span>
         <span class="n">torch</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,nj-&gt;n&#39;</span><span class="p">,</span> <span class="n">abs_W_t</span><span class="p">,</span> <span class="n">h</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">-</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;i,ni-&gt;n&#39;</span><span class="p">,</span> <span class="n">effective_v_bias</span><span class="p">,</span> <span class="n">v_analog</span><span class="p">)</span> <span class="o">+</span>
        <span class="p">(</span><span class="mf">0.5</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_v</span><span class="p">)</span> <span class="o">*</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;i,ni-&gt;n&#39;</span><span class="p">,</span> <span class="n">abs_v_bias</span><span class="p">,</span> <span class="n">v_analog</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_v</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">power_backward</span> <span class="o">=</span> <span class="n">power_backward</span> <span class="o">+</span> <span class="p">(</span>
            <span class="o">+</span><span class="n">torch</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,nj-&gt;n&#39;</span><span class="p">,</span> <span class="n">abs_W_t</span> <span class="o">-</span> <span class="n">W_t</span><span class="p">,</span>
                          <span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">*</span> <span class="n">h</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">4</span><span class="p">))</span> <span class="o">+</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_v</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span>
            <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">abs_v_bias</span> <span class="o">-</span> <span class="n">v_bias</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">power_backward</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.power_forward" class="doc doc-heading">
            <code class=" language-python"><span class="n">power_forward</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Computes the power dissipated by the RKM in the forward pass.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>v</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Visible units, shape (N, n_v).</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="torch.Tensor">Tensor</span></code>
          â€“
          <div class="doc-md-description">
            <p>Power dissipated by the RKM, shape (N,).</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">power_forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes the power dissipated by the RKM in the forward pass.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    v : torch.Tensor</span>
<span class="sd">        Visible units, shape (N, n_v).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    torch.Tensor</span>
<span class="sd">        Power dissipated by the RKM, shape (N,).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">effective_h_bias</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_bias</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">*</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_bias</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_bias</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_h</span> <span class="o">+</span>
        <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W_t</span><span class="p">)</span> <span class="o">+</span> <span class="n">effective_h_bias</span>
    <span class="n">den</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_bias</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_h</span>
    <span class="n">h_analog</span> <span class="o">=</span> <span class="n">num</span> <span class="o">/</span> <span class="n">den</span>

    <span class="n">W_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W_t</span>
    <span class="n">abs_W_t</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W_t</span><span class="p">)</span>
    <span class="n">h_bias</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_bias</span>
    <span class="n">abs_h_bias</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_bias</span><span class="p">)</span>

    <span class="n">power_forward</span> <span class="o">=</span> <span class="p">(</span>
        <span class="o">-</span><span class="n">torch</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ni,ij,nj-&gt;n&#39;</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">W_t</span><span class="p">,</span> <span class="n">h_analog</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span>
        <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ni,ij-&gt;n&#39;</span><span class="p">,</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">abs_W_t</span><span class="p">)</span> <span class="o">+</span>
         <span class="n">torch</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ij,nj-&gt;n&#39;</span><span class="p">,</span> <span class="n">abs_W_t</span><span class="p">,</span> <span class="n">h_analog</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">-</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;j,nj-&gt;n&#39;</span><span class="p">,</span> <span class="n">effective_h_bias</span><span class="p">,</span> <span class="n">h_analog</span><span class="p">)</span> <span class="o">+</span>
        <span class="p">(</span><span class="mf">0.5</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_h</span><span class="p">)</span> <span class="o">*</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;j,nj-&gt;n&#39;</span><span class="p">,</span> <span class="n">abs_h_bias</span><span class="p">,</span> <span class="n">h_analog</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_h</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">power_forward</span> <span class="o">=</span> <span class="n">power_forward</span> <span class="o">+</span> <span class="p">(</span><span class="o">+</span><span class="n">torch</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
            <span class="s1">&#39;ni,ij-&gt;n&#39;</span><span class="p">,</span>
            <span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">*</span> <span class="n">v</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">4</span><span class="p">),</span> <span class="n">abs_W_t</span> <span class="o">-</span> <span class="n">W_t</span><span class="p">)</span> <span class="o">+</span>
                                         <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span>
                                          <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_h</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                                         <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">abs_h_bias</span> <span class="o">-</span> <span class="n">h_bias</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">power_forward</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.pretrain" class="doc doc-heading">
            <code class=" language-python"><span class="n">pretrain</span><span class="p">(</span><span class="n">pretrained_model</span><span class="p">,</span> <span class="n">model_state_path</span><span class="o">=</span><span class="s1">&#39;model_states/&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Pretrain the model using a pretrained model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>pretrained_model</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>)
          â€“
          <div class="doc-md-description">
            <p>Name of the pretrained model.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>model_state_path</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>, default:
                  <code>&#39;model_states/&#39;</code>
)
          â€“
          <div class="doc-md-description">
            <p>Path to the model states, by default 'model_states/'.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pretrain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pretrained_model</span><span class="p">,</span> <span class="n">model_state_path</span><span class="o">=</span><span class="s1">&#39;model_states/&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Pretrain the model using a pretrained model.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pretrained_model : str</span>
<span class="sd">        Name of the pretrained model.</span>
<span class="sd">    model_state_path : str, optional</span>
<span class="sd">        Path to the model states, by default &#39;model_states/&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if you have model load points</span>
    <span class="n">ensure_dir</span><span class="p">(</span><span class="n">model_state_path</span><span class="p">)</span>
    <span class="n">filename_list</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">model_state_path</span> <span class="o">+</span>
                              <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_t*.pkl&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pretrained_model</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filename_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">all_loadpoints</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_t&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.pkl&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">filename_list</span>
        <span class="p">])</span>
        <span class="n">last_epoch</span> <span class="o">=</span> <span class="n">all_loadpoints</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** Using as pretraining model </span><span class="si">{}</span><span class="s1"> at epoch </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">pretrained_model</span><span class="p">,</span> <span class="n">last_epoch</span><span class="p">),</span>
              <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
                <span class="n">model_state_path</span> <span class="o">+</span>
                <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_t</span><span class="si">{}</span><span class="s1">.pkl&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pretrained_model</span><span class="p">,</span> <span class="n">last_epoch</span><span class="p">),</span>
                <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">temp_model</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="c1"># *** Import pretrained parameters</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">temp_model</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mytype</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">h_bias</span> <span class="o">=</span> <span class="n">temp_model</span><span class="o">.</span><span class="n">h_bias</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mytype</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v_bias</span> <span class="o">=</span> <span class="n">temp_model</span><span class="o">.</span><span class="n">v_bias</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mytype</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** No load points for </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pretrained_model</span><span class="p">),</span>
              <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.reconstruct" class="doc doc-heading">
            <code class=" language-python"><span class="n">reconstruct</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Reconstruct the visible units from the data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>data</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/array.html#module-array">array</a> - <span title="like">like</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Input data.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>k</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>)
          â€“
          <div class="doc-md-description">
            <p>Number of Gibbs sampling steps.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>tuple of numpy.ndarray</code>
          â€“
          <div class="doc-md-description">
            <p>Original and reconstructed visible units.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reconstruct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reconstruct the visible units from the data.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : array-like</span>
<span class="sd">        Input data.</span>
<span class="sd">    k : int</span>
<span class="sd">        Number of Gibbs sampling steps.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple of numpy.ndarray</span>
<span class="sd">        Original and reconstructed visible units.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mytype</span><span class="p">)</span>
    <span class="n">v_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">v_model</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.relaxation_times" class="doc doc-heading">
            <code class=" language-python"><span class="n">relaxation_times</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Computes the relaxation times of the RKM in the forward and backward pass.</p>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>tuple of torch.Tensor</code>
          â€“
          <div class="doc-md-description">
            <p>t_forward : relaxation times of the RKM in the forward pass, shape (n_v,).
t_backward : relaxation times of the RKM in the backward pass, shape (n_h,).</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">relaxation_times</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes the relaxation times of the RKM in the forward and backward pass.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple of torch.Tensor</span>
<span class="sd">        t_forward : relaxation times of the RKM in the forward pass, shape (n_v,).</span>
<span class="sd">        t_backward : relaxation times of the RKM in the backward pass, shape (n_h,).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t_forward</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span>
                     <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_bias</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_h</span><span class="p">)</span>
    <span class="n">t_backward</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span>
                      <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_bias</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_v</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">t_forward</span><span class="p">,</span> <span class="n">t_backward</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.train" class="doc doc-heading">
            <code class=" language-python"><span class="n">train</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span><span class="o">=</span><span class="p">[],</span> <span class="n">print_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">print_test_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">model_state_path</span><span class="o">=</span><span class="s1">&#39;model_states/&#39;</span><span class="p">,</span> <span class="n">print_every</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Train the model using the given data and parameters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>train_data</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Training data.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>test_data</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>, default:
                  <code>[]</code>
)
          â€“
          <div class="doc-md-description">
            <p>Test data, by default [].</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>print_error</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>False</code>
)
          â€“
          <div class="doc-md-description">
            <p>Whether to print training error, by default False.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>print_test_error</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>, default:
                  <code>False</code>
)
          â€“
          <div class="doc-md-description">
            <p>Whether to print test error, by default False.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>model_state_path</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>, default:
                  <code>&#39;model_states/&#39;</code>
)
          â€“
          <div class="doc-md-description">
            <p>Path to save model states, by default 'model_states/'.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>print_every</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>, default:
                  <code>100</code>
)
          â€“
          <div class="doc-md-description">
            <p>Frequency of printing progress, by default 100.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
          <span class="n">train_data</span><span class="p">,</span>
          <span class="n">test_data</span><span class="o">=</span><span class="p">[],</span>
          <span class="n">print_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
          <span class="n">print_test_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
          <span class="n">model_state_path</span><span class="o">=</span><span class="s1">&#39;model_states/&#39;</span><span class="p">,</span>
          <span class="n">print_every</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Train the model using the given data and parameters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    train_data : torch.Tensor</span>
<span class="sd">        Training data.</span>
<span class="sd">    test_data : torch.Tensor, optional</span>
<span class="sd">        Test data, by default [].</span>
<span class="sd">    print_error : bool, optional</span>
<span class="sd">        Whether to print training error, by default False.</span>
<span class="sd">    print_test_error : bool, optional</span>
<span class="sd">        Whether to print test error, by default False.</span>
<span class="sd">    model_state_path : str, optional</span>
<span class="sd">        Path to save model states, by default &#39;model_states/&#39;.</span>
<span class="sd">    print_every : int, optional</span>
<span class="sd">        Frequency of printing progress, by default 100.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_epochs</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">t</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v_data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">train_data</span><span class="p">):</span>

            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="c1"># restart the power</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">power_f</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">power_b</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># For the positive phase, we use the data and propagate to the hidden nodes</span>
            <span class="n">h_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_to_h</span><span class="p">(</span><span class="n">v_data</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">p_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">power_forward</span><span class="p">(</span><span class="n">v_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">power_f</span> <span class="o">+=</span> <span class="n">p_f</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">+=</span> <span class="n">p_f</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

            <span class="c1"># For the negative phase, it depends on the training algorithm</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_algo</span> <span class="o">==</span> <span class="s1">&#39;PCD&#39;</span><span class="p">:</span>
                <span class="c1"># Update the chain after every batch</span>
                <span class="c1"># self.persistent_chains = self.forward(</span>
                <span class="c1">#     self.persistent_chains, self.k)</span>
                <span class="n">v_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">persistent_chains</span>
                <span class="c1"># print(</span>
                <span class="c1">#     &#39;Warning: No physical measurements are implemented for PCD training algorithm.&#39;</span>
                <span class="c1"># )</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">):</span>
                    <span class="n">h_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_to_h</span><span class="p">(</span><span class="n">v_model</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">p_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">power_forward</span><span class="p">(</span><span class="n">v_model</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">power_f</span> <span class="o">+=</span> <span class="n">p_f</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

                    <span class="n">v_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_to_v</span><span class="p">(</span><span class="n">h_model</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">p_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">power_backward</span><span class="p">(</span><span class="n">h_model</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">power_b</span> <span class="o">+=</span> <span class="n">p_b</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">+=</span> <span class="n">p_f</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">p_b</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">persistent_chains</span> <span class="o">=</span> <span class="n">v_model</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_algo</span> <span class="o">==</span> <span class="s1">&#39;RDM&#39;</span><span class="p">:</span>
                <span class="n">v_model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">high</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">n_visible</span><span class="p">),</span>
                                        <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
                                        <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mytype</span><span class="p">)</span>
                <span class="n">v_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">v_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s1">&#39;Warning: No physical measurements are implemented for RDM training algorithm.&#39;</span>
                    <span class="o">+</span> <span class="s1">&#39;Use hRDM or vRDM instead.&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_algo</span> <span class="o">==</span> <span class="s1">&#39;CD&#39;</span><span class="p">:</span>
                <span class="n">v_model</span> <span class="o">=</span> <span class="n">v_data</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">):</span>
                    <span class="n">h_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_to_h</span><span class="p">(</span><span class="n">v_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_beta</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">p_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">power_forward</span><span class="p">(</span><span class="n">v_model</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">power_f</span> <span class="o">+=</span> <span class="n">p_f</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

                    <span class="n">v_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_to_v</span><span class="p">(</span><span class="n">h_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_beta</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">p_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">power_backward</span><span class="p">(</span><span class="n">h_model</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">power_b</span> <span class="o">+=</span> <span class="n">p_b</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">+=</span> <span class="n">p_f</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">p_b</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_algo</span> <span class="o">==</span> <span class="s1">&#39;vRDM&#39;</span><span class="p">:</span>
                <span class="c1"># visible RDM</span>
                <span class="n">v_model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">high</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">n_visible</span><span class="p">),</span>
                                        <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
                                        <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mytype</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">):</span>
                    <span class="n">h_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_to_h</span><span class="p">(</span><span class="n">v_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_beta</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">p_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">power_forward</span><span class="p">(</span><span class="n">v_model</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">power_f</span> <span class="o">+=</span> <span class="n">p_f</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

                    <span class="n">v_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_to_v</span><span class="p">(</span><span class="n">h_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_beta</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">p_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">power_backward</span><span class="p">(</span><span class="n">h_model</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">power_b</span> <span class="o">+=</span> <span class="n">p_b</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">+=</span> <span class="n">p_f</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">p_b</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_algo</span> <span class="o">==</span> <span class="s1">&#39;hRDM&#39;</span><span class="p">:</span>
                <span class="c1"># hidden RDM</span>
                <span class="n">h_model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">high</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                        <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">n_hidden</span><span class="p">),</span>
                                        <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
                                        <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mytype</span><span class="p">)</span>
                <span class="n">v_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_to_v</span><span class="p">(</span><span class="n">h_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_beta</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">p_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">power_backward</span><span class="p">(</span><span class="n">h_model</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">power_b</span> <span class="o">+=</span> <span class="n">p_b</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">+=</span> <span class="n">p_b</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">h_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_to_h</span><span class="p">(</span><span class="n">v_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_beta</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">p_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">power_forward</span><span class="p">(</span><span class="n">v_model</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">power_f</span> <span class="o">+=</span> <span class="n">p_f</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

                    <span class="n">v_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_to_v</span><span class="p">(</span><span class="n">h_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_beta</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">p_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">power_backward</span><span class="p">(</span><span class="n">h_model</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">power_b</span> <span class="o">+=</span> <span class="n">p_b</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">+=</span> <span class="n">p_f</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="n">p_b</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

            <span class="c1"># Apply centering</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">centering</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">batch_ov</span> <span class="o">=</span> <span class="n">v_data</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">batch_oh</span> <span class="o">=</span> <span class="n">h_data</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="c1"># update with sliding</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ov</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">slv</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ov</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">slv</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_ov</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">oh</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">slh</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">oh</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">slh</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_oh</span>

            <span class="c1"># Compute gradients</span>
            <span class="n">dEdW_data</span><span class="p">,</span> <span class="n">dEdv_bias_data</span><span class="p">,</span> <span class="n">dEdh_bias_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derivatives</span><span class="p">(</span>
                <span class="n">v_data</span><span class="p">,</span> <span class="n">h_data</span><span class="p">)</span>
            <span class="n">dEdW_model</span><span class="p">,</span> <span class="n">dEdv_bias_model</span><span class="p">,</span> <span class="n">dEdh_bias_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derivatives</span><span class="p">(</span>
                <span class="n">v_model</span><span class="p">,</span> <span class="n">h_model</span><span class="p">)</span>

            <span class="c1"># Average over batch</span>
            <span class="n">dEdW_data</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dEdW_data</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">dEdv_bias_data</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dEdv_bias_data</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">dEdh_bias_data</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dEdh_bias_data</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">dEdW_model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dEdW_model</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">dEdv_bias_model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dEdv_bias_model</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">dEdh_bias_model</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dEdh_bias_model</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># Update weights and biases</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">==</span> <span class="s1">&#39;Adam&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Adam_update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epoch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dEdW_data</span><span class="p">,</span> <span class="n">dEdW_model</span><span class="p">,</span>
                                 <span class="n">dEdv_bias_data</span><span class="p">,</span> <span class="n">dEdv_bias_model</span><span class="p">,</span>
                                 <span class="n">dEdh_bias_data</span><span class="p">,</span> <span class="n">dEdh_bias_model</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">==</span> <span class="s1">&#39;SGD&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SGD_update</span><span class="p">(</span><span class="n">dEdW_data</span><span class="p">,</span> <span class="n">dEdW_model</span><span class="p">,</span> <span class="n">dEdv_bias_data</span><span class="p">,</span>
                                <span class="n">dEdv_bias_model</span><span class="p">,</span> <span class="n">dEdh_bias_data</span><span class="p">,</span>
                                <span class="n">dEdh_bias_model</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">after_step_keepup</span><span class="p">()</span>

            <span class="c1"># compute new relaxation times</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">relax_t_f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">relax_t_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relaxation_times</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">epoch</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Store the model state</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_to_save</span><span class="p">:</span>
                <span class="n">ensure_dir</span><span class="p">(</span><span class="n">model_state_path</span><span class="p">)</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
                        <span class="n">model_state_path</span> <span class="o">+</span>
                        <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_t</span><span class="si">{}</span><span class="s1">.pkl&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch</span><span class="p">),</span>
                        <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">epoch</span> <span class="o">%</span> <span class="n">print_every</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
                <span class="k">if</span> <span class="n">print_error</span><span class="p">:</span>
                    <span class="n">v_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">v_data</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">rec_error_train</span> <span class="o">=</span> <span class="p">((</span><span class="n">v_model</span> <span class="o">-</span>
                                        <span class="n">v_data</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">print_test_error</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Epoch: </span><span class="si">%d</span><span class="s1"> , train-err </span><span class="si">%.5g</span><span class="s1"> , time: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span>
                              <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epoch</span><span class="p">,</span> <span class="n">rec_error_train</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span>
                              <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">t_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="n">rec_error_test</span> <span class="o">=</span> <span class="p">((</span><span class="n">t_model</span> <span class="o">-</span>
                                           <span class="n">test_data</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span>
                            <span class="s1">&#39;Epoch: </span><span class="si">%d</span><span class="s1"> , Test-err </span><span class="si">%.5g</span><span class="s1"> , train-err </span><span class="si">%.5g</span><span class="s1"> , time: </span><span class="si">%f</span><span class="s1">&#39;</span>
                            <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epoch</span><span class="p">,</span> <span class="n">rec_error_test</span><span class="p">,</span> <span class="n">rec_error_train</span><span class="p">,</span>
                               <span class="n">t</span><span class="p">),</span>
                            <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Epoch: </span><span class="si">%d</span><span class="s1"> , time: </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epoch</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span>
                          <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*** Training finished&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pyrkm.rkm.RKM.v_to_h" class="doc doc-heading">
            <code class=" language-python"><span class="n">v_to_h</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Convert visible units to hidden units.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>v</code></b>
              (<code><span title="torch.Tensor">Tensor</span></code>)
          â€“
          <div class="doc-md-description">
            <p>Visible units.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>beta</code></b>
              (<code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>, default:
                  <code>None</code>
)
          â€“
          <div class="doc-md-description">
            <p>Inverse temperature parameter, by default None.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code>tuple of torch.Tensor</code>
          â€“
          <div class="doc-md-description">
            <p>Probabilities and sampled hidden units.</p>
          </div>
        </li>
    </ul>


            <details class="quote">
              <summary>Source code in <code>src/pyrkm/rkm.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">v_to_h</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert visible units to hidden units.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    v : torch.Tensor</span>
<span class="sd">        Visible units.</span>
<span class="sd">    beta : float, optional</span>
<span class="sd">        Inverse temperature parameter, by default None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple of torch.Tensor</span>
<span class="sd">        Probabilities and sampled hidden units.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">beta</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_beta</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy_type</span> <span class="o">==</span> <span class="s1">&#39;RKM&#39;</span><span class="p">:</span>
        <span class="n">effective_h_bias</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_bias</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">*</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_bias</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_bias</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_h</span> <span class="o">+</span>
            <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W_t</span><span class="p">)</span> <span class="o">+</span> <span class="n">effective_h_bias</span>
        <span class="n">den</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_bias</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">g_h</span>
        <span class="n">h_analog</span> <span class="o">=</span> <span class="n">num</span> <span class="o">/</span> <span class="n">den</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling</span> <span class="o">==</span> <span class="s1">&#39;bernoulli&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_scaled</span><span class="p">:</span>
                <span class="n">p_h</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">beta</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_visible</span> <span class="o">*</span> <span class="n">h_analog</span><span class="p">)</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">bernoulli</span><span class="p">(</span><span class="n">p_h</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p_h</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">beta</span> <span class="o">*</span> <span class="n">h_analog</span><span class="p">)</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">bernoulli</span><span class="p">(</span><span class="n">p_h</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling</span> <span class="o">==</span> <span class="s1">&#39;multi-threshold&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span> <span class="o">==</span> <span class="s1">&#39;gaussian&#39;</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn_like</span><span class="p">(</span><span class="n">h_analog</span><span class="p">,</span>
                                     <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mytype</span><span class="p">,</span>
                                     <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">beta</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand_like</span><span class="p">(</span>
                    <span class="n">h_analog</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mytype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span>
                     <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">beta</span>
            <span class="n">p_h</span> <span class="o">=</span> <span class="n">h_analog</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_scaled</span><span class="p">:</span>
                <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_h</span> <span class="o">&gt;</span> <span class="n">t</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_visible</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_h</span> <span class="o">&gt;</span> <span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">sampling</span> <span class="o">==</span> <span class="s1">&#39;single-threshold&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span> <span class="o">==</span> <span class="s1">&#39;gaussian&#39;</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span>
                    <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mytype</span><span class="p">,</span>
                    <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span>
                        <span class="n">h_analog</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mytype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mytype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> <span class="o">*</span>
                     <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span>
                         <span class="n">h_analog</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mytype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
            <span class="n">p_h</span> <span class="o">=</span> <span class="n">h_analog</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_scaled</span><span class="p">:</span>
                <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_h</span> <span class="o">&gt;</span> <span class="n">t</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_visible</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_h</span> <span class="o">&gt;</span> <span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p_h</span><span class="p">,</span> <span class="n">h</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">v_to_h</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>